<?php
// ===== Api Class =====
class Api {
    public $api_url = 'https://kd1s.com/api/v2';
    public $api_key = '348dd4c889fc1e93bfa4a0257ae245a3';

    public function order($data) {
        $post = array_merge(['key' => $this->api_key, 'action' => 'add'], $data);
        return json_decode((string)$this->connect($post));
    }

    private function connect($post) {
        $_post = [];
        if (is_array($post)) {
            foreach ($post as $name => $value) {
                $_post[] = $name . '=' . urlencode($value);
            }
        }
        $ch = curl_init($this->api_url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_POST, 1);
        curl_setopt($ch, CURLOPT_HEADER, 0);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
        if (is_array($post)) { curl_setopt($ch, CURLOPT_POSTFIELDS, join('&', $_post)); }
        curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/4.0');
        $result = curl_exec($ch);
        if (curl_errno($ch) != 0 && empty($result)) { $result = false; }
        curl_close($ch);
        return $result;
    }
}

// ===== Handle AJAX Request =====
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['service'])) {
    header('Content-Type: application/json');
    $service = $_POST['service'];
    $link = $_POST['link'] ?? '';
    $quantity = $_POST['quantity'] ?? 1;

    if(empty($service) || empty($link)){
        echo json_encode(['success'=>false,'message'=>'Service أو link مفقود']);
        exit;
    }

    $api = new Api();
    $order = $api->order([
        'service' => $service,
        'link' => $link,
        'quantity' => $quantity
    ]);

    echo json_encode($order);
    exit;
}
?>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>خدماتكم</title>
<style>
body { font-family: Arial, sans-serif; background-color: #f8fef8; margin:0; padding:0; }
header { background-color: #4CAF50; color:white; padding:15px 0; text-align:center; font-size:24px; }
nav { background-color: #3e8e41; padding:10px; text-align:center; }
nav a { color:white; text-decoration:none; margin:0 15px; font-size:16px; }
.container { padding:20px; max-width:800px; margin:auto; }
h2 { text-align:center; color:#333; }
.services { display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:20px; }
.service-box { background-color:#fff; border:1px solid #ddd; border-radius:10px; text-align:center; padding:20px; transition:0.3s; box-shadow:0 0 10px #eee; }
.service-box:hover { transform:scale(1.03); box-shadow:0 0 15px #ccc; }
.service-box a { text-decoration:none; color:#4CAF50; font-weight:bold; cursor:pointer; }
.contact-buttons { margin-top:40px; text-align:center; }
.contact-buttons a { display:inline-block; margin:10px; padding:10px 25px; color:white; background-color:#4CAF50; text-decoration:none; border-radius:8px; font-size:16px; }
</style>
</head>
<body>

<header>خدماتكم</header>

<nav>
<a href="login.html">تسجيل دخول</a>
<a href="contact.html">تواصل معنا</a>
</nav>

<div class="container">
<h2>اختر الخدمة المطلوبة</h2>

<div class="services">
<div class="service-box"><a data-service="1">خدمة تيك توك</a></div>
<div class="service-box"><a data-service="2">خدمة انستغرام</a></div>
<div class="service-box"><a data-service="3">خدمة فيسبوك</a></div>
<div class="service-box"><a data-service="4">شدات ببجي</a></div>
<div class="service-box"><a data-service="5">جواهر لودو</a></div>
<div class="service-box"><a data-service="6">عملات بيس</a></div>
</div>

<div class="contact-buttons">
<a href="https://t.me/vvvvfff">تواصل تيليگرام</a>
<a href="#">تواصل واتساب</a>
</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".service-box a").forEach(link => {
    link.addEventListener("click", (e) => {
      e.preventDefault();
      const serviceId = e.target.dataset.service;
      const postData = new URLSearchParams();
      postData.append('service', serviceId);
      postData.append('link', 'http://example.com/test'); // ضع الرابط الصحيح
      postData.append('quantity', '100'); // ضع الكمية المطلوبة

      fetch('', { method:'POST', body:postData })
      .then(res=>res.json())
      .then(data=>{
        if(data.success || data.order) alert('تم إرسال الطلب بنجاح!');
        else alert('حدث خطأ: '+(data.message || 'غير معروف'));
      })
      .catch(err=>alert('حدث خطأ في الاتصال بالخدمة'));
    });
  });
});
</script>

</body>
</html>
